---
date: 2021.10.14
title: SQL
tag: 
---


# SQL



### DDL, DML, DCL

- DDL : **CREATE**, ALTER, **DROP**
- DML : **SELECT**, **INSERT**, **UPDATE**, **DELETE**
- DCL : GRANT, REVOKE

```sqlite
CREATE TABLE test (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, title TEXT)
SELECT title FROM test WHERE id = 1;
INSERT INTO test (title) VALUES ("sql");
UPDATE test SET title="sqlite" WHERE id = 1;
DELETE FROM test WHERE id = 1;
DROP TABLE test;
```



### μ„λΈμΏΌλ¦¬

```sqlite
CREATE TABLE user (id INTEGER PRIMARY KEY AUTOINCREMENT, userid TEXT, name TEXT);
CREATE TABLE cart (id INTEGER PRIMARY KEY AUTOINCREMENT, userid TEXT, itemcount INTEGER);
SELECT userid FROM user WHERE userid IN (SELECT userid FROM cart WHERE itemcount > 5);
```



### JOIN

- inner join
- left join
- right join

```sqlite

```



### UNION

- union
- union all

```sqlite

```



### μΈλ±μ¤

- μ¥μ  : λΉ λ¥Έ κ²€μƒ‰ (ν•΄λ‹Ή ν•„λ“λ΅ λ―Έλ¦¬ μ •λ ¬λμ–΄ μμ)
- λ‹¨μ  : κ²€μƒ‰ μ™Έμ μ‘μ—…(μ‚½μ…/κ°±μ‹ /μ‚­μ )μ— λ¶€ν• λ°μƒ, λ””μ¤ν¬ κ³µκ°„ μ”κµ¬
- μΆ…λ¥ : 
  - κΈ°λ³Έν‚¤ μΈλ±μ¤ : κΈ°λ³Έν‚¤μ— μλ™μΌλ΅ μ„¤μ •λ¨
  - λ‹¨μΌ μ»¬λΌ μΈλ±μ¤ : μ»¬λΌ ν•λ‚λ΅ μ„¤μ •
  - λ‹¤μ¤‘ μ»¬λΌ μΈλ±μ¤ : λ‹¤μμ μ»¬λΌμΌλ΅ μ„¤μ •
  - μ λ‹ν¬ μΈλ±μ¤ : μ¤‘λ³µλλ” κ°’μ΄ μ—†μ–΄μ•Ό ν•¨
  - μ»¤λ²„λ§ μΈλ±μ¤ : μΈλ±μ¤λ§ μ΅°νν•μ—¬ μ›ν•λ” κ°’μ„ μ–»μ„ μ μλ” κ²½μ°...

```sqlite
/* ν…μ΄λΈ”κ³Ό λ μ½”λ“ μ¤€λΉ„ */
CREATE TABLE test ( id INTEGER PRIMARY KEY AUTOINCREMENT, c1 TEXT, c2 TEXT ); -- ν…μ΄λΈ”

WITH RECURSIVE
  cnt(x, y) AS (
	 SELECT 1, 10000000
	 UNION ALL
     SELECT x + 1, 10000000 - (x + 1) FROM cnt
     LIMIT 10000000
  )
INSERT INTO test (c1, c2) SELECT x, y FROM cnt; -- λ°μ΄ν„° μ²λ§κ±΄ μ‚½μ…
```

```sqlite
/* μΈλ±μ¤ μ λ¬΄μ— λ”°λ¥Έ κ²€μƒ‰ μ„±λ¥ λΉ„κµ */
SELECT * FROM test WHERE id = 7770000; -- κΈ°λ³Έν‚¤(κΈ°λ³Έν‚¤ μΈλ±μ¤)λ΅ κ²€μƒ‰ : 2ms π‘
EXPLAIN QUERY PLAN SELECT * FROM test WHERE id = 7770000; 
-- μΏΌλ¦¬ ν”λ : SEARCH TABLE test USING INTEGER PRIMARY KEY (rowid=?)

SELECT * FROM test WHERE c1 = '7770000'; -- μΈλ±μ¤κ°€ μ—†λ” ν•„λ“λ΅ κ²€μƒ‰ : 6000ms π‘
EXPLAIN QUERY PLAN SELECT * FROM test WHERE c1 = '7770000'; 
-- μΏΌλ¦¬ ν”λ : SCAN TABLE test π‘ (ν…μ΄λΈ” μ¤μΊ”)

CREATE INDEX myindex1 ON test (c1); -- c1 ν•„λ“μ— μΈλ±μ¤ μƒμ„±
-- CREATE UNIQUE INDEX myindex1 ON test (c1); -- c1 ν•„λ“μ— μ λ‹ν¬ μΈλ±μ¤ μƒμ„±

SELECT * FROM test WHERE c1 = 7770000; -- μΈλ±μ¤κ°€ μλ” ν•„λ“λ΅ κ²€μƒ‰ : 2ms π‘
EXPLAIN QUERY PLAN SELECT * FROM test WHERE c1 = 7770000; 
-- μΏΌλ¦¬ ν”λ : SEARCH TABLE test USING COVERING INDEX myindex1 (c1=?)
```

```sqlite
/* λ‹¨μΌ, λ‹¤μ¤‘ μ»¬λΌ μΈλ±μ¤μ— λ”°λ¥Έ κ²€μƒ‰ μ„±λ¥ λΉ„κµ */
SELECT * FROM test WHERE c1 >= 7770000 and c2 = 2230000; -- λ‹¨μΌ μ»¬λΌ μΈλ±μ¤ : 1600ms π‘

CREATE INDEX myindex2 ON test (c1 ASC, c2 DESC);
SELECT * FROM test WHERE c1 >= 7770000 and c2 = 2230000; -- λ‹¤μ¤‘ μ»¬λΌ μΈλ±μ¤ : 700ms π‘

CREATE INDEX myindex3 ON test (c2 DESC);
SELECT * FROM test WHERE c1 >= 7770000 and c2 = 2230000; -- λ‹¨μΌ μ»¬λΌ μΈλ±μ¤ 2κ° : 2ms π‘
```

```sqlite
/* μΈλ±μ¤ μ‚½μ… μ„±λ¥ λΉ„κµ */
WITH RECURSIVE ... LIMIT 10000 ...
INSERT INTO test (c1) SELECT x FROM cnt; -- μΈλ±μ¤κ°€ μμ„ λ• 1λ§κ±΄ μ‚½μ… : 120ms π‘

DROP INDEX myindex1; -- μΈλ±μ¤ μ‚­μ 
...

WITH RECURSIVE ... LIMIT 10000 ...
INSERT INTO test (c1) SELECT x FROM cnt; -- μΈλ±μ¤κ°€ μ—†μ„ λ• 1λ§κ±΄ μ‚½μ… : 12ms π‘
```



### μ„μ‹ν…μ΄λΈ”

- μ¥μ  : μΈλ±μ¤λ¥Ό μƒμ„±ν•  μ μλ‹¤(λΉ λ¥Έ κ²€μƒ‰)
- λ‹¨μ  : μ›λ³Έ ν…μ΄λΈ”μ μμ • μ‚¬ν•­μ„ μ‹¤μ‹κ°„ λ°μν•μ§€ μ•μ

```sqlite
CREATE TEMPORARY TABLE t_test AS SELECT name FROM test WHERE id > 9000000; -- μΌλ¶€ λ°μ΄ν„°
CREATE INDEX myindex ON t_test (name); -- μ„μ‹ν…μ΄λΈ”μ— μΈλ±μ¤ μƒμ„±
EXPLAIN QUERY PLAN SELECT * FROM t_test WHERE name = '9000001';
-- μΏΌλ¦¬ ν”λ ν™•μΈ : SEARCH TABLE t_test USING COVERING INDEX myindex (name=?)
SELECT * FROM t_test WHERE name = '9000001'; -- 2ms π‘
```



### λ·°

- μ¥μ  : λ³µμ΅ν• μΏΌλ¦¬λ¥Ό λ·°λ΅ λ§λ“¤μ–΄ λ‹¨μν™”ν•  μ μλ‹¤
- λ‹¨μ  : μΈλ±μ¤λ¥Ό μƒμ„±ν•  μ μ—†λ‹¤(λλ¦° κ²€μƒ‰)

```sqlite
CREATE VIEW v_test AS SELECT name FROM test WHERE id > 9000000;
EXPLAIN QUERY PLAN SELECT * FROM v_test WHERE name = '9000001';
-- μΏΌλ¦¬ ν”λ : SEARCH TABLE test USING INTEGER PRIMARY KEY (rowid>?)
SELECT * FROM v_test WHERE name = '9000001'; -- 300ms
```



### μ €μ¥ ν”„λ΅μ‹μ €



### μ°Έκ³ 

- [ν‰μƒ ν•„μ”ν• λ°μ΄ν„° λ¶„μ„ - MySQLκ³Ό μ£Όμ‹ λ°μ΄ν„°λ΅ μ¬λ°κ²](https://wikidocs.net/book/6371)
- [λ°μ΄ν„°λ² μ΄μ¤](http://tcpschool.com/mysql/DB)
- [SQL κ³ κΈ‰ #1](https://aroundck.tistory.com/5184)
- [μ„±λ¥ ν–¥μƒμ„ μ„ν• SQL μ‘μ„±λ²•](https://d2.naver.com/helloworld/1155)

